# 毕业总结 

特别想记录一下自己深切遇到的问题，虽然已经是前东家了，但是印象还是极其深刻：
### 团队单体架构问题
早期应用大多是单体架构，后端服务、前端页面都在写在同一个系统里，部署非常方便，直接打包部署即可，带来了很多问题：

- **开发人员需要掌握的较多**。当然早期vue什么的都还未流行，那会大多使用`ajax`,`jquery`，大家都是后端、前端一起开发、写单元测试
- **版本控制沟通成本大**。大家都在一个组内，系统就一个，提交、拉取、推送代码时要小心，最好是不要冲突。如果出现冲突了，解决该问题可能还需要别的开发来协助，毕竟一个系统，大家又分工合作，一般都是对自己负责的业务熟悉。因此才需要别的开发协助，别把同事的代码给勿删了。
- **后期维护难**。业务越复杂，代码量越大，原有系统代码增减越频繁，导致代码真的是一坨又一坨，没有谁一开始就能设计好完美架构，能适配未来所有场景。不然，也不会有此文章了。
- **部署容易，运维难**。因为是一个系统，只要代码有丁点儿改动，整个项目就要重新编译、打包、发镜像、发不同环境(测试、灰度、生产等)。笔者在前公司时，负责的一个财务系统非常复杂，是三个大系统合并后的，光编译+打包就得25分左右，快的时候18分（当时使用JDos发布），所以经常会有旁边同事说：”帮我发下XX项目，我去楼下抽根烟“......
- **测试不流畅，严重依赖全局**。笔者作为应届生，刚进入公司，正好遇上轮值测试岗，那会我们组专门有配备测试哥哥，曾跟着这个测试哥哥写过测试用例。整个测试用例，根据功能(或者说业务)来划分，然后再对应某个功能细分接口测试，写的非常详细，并且根据优先级来决定先测哪些系统。我仍记得17年那个冬天，因为一个开发小哥哥的项目有问题，导致后面的系统根本没法测试，而他的项目也没完成，也没法测试，只能等他解决了才能做后续步骤。测试环境早就搭好了，就等项目发布测试了，结果却来这一出，我们就这样干等了一下午，直到晚上快吃饭他才解决了。但是deadline是不变的，于是我们几个测试又加班加点开始一个一个测试，测出来问题就提BUG，催他们解决。这样的场景并不是只有这一次，说出来都是泪......
- **生产环境出问题影响大**。项目正常运行还好，但是一出事就是事故，本来A服务正常，却因为B服务挂掉，导致整个项目都挂，所以项目必须降级(手动切回老版本)，然后再解决问题，解决了再重新发布到新版本，最后leader组织复盘，吸取教训。

正是因为有上述问题，所谓的敏捷开发和部署(当时内部开始推广)成了空中楼阁，很多次会议都耗时、耗心，甚至影响到了组内团结。

### 日志记录问题
在实际业务开发中，尤其是多层架构中，日志可能到处打印，以传统的三层架构为例：
- service层记录了一次日志
- dao层又记录了一次日志
- controller层也会记录一次日志

这样导致的结果就是日志打印到处都是，影响服务性能，日志落盘的时候是必定耗时且占用内存的。

笔者就遇到过容器的内存因为日志占满导致服务不可用的事故，当时没有人想到是日志的问题，反正是报 OOM了。

于是团队开始查看各指标，发现接口服务正常、worker任务、消息队列、redis服务等也正常，没有积压，然后使用了重启大法，结果服务还是异常，查看日志时，发现并没有任何新日志进来，看了日志配置也正常，最后竟发现日志占比已经100%了，于是清了日志，服务才正常了。

后来复盘时，主要做了以下改善:
- 核心系统增加日志占比报警（短信、邮件），超85%上报
- 各系统负责人每三天检查日志占比，满85%就可以清理
- 各系统负责人查看日志打印情况，去掉不必要的日志，优化现有日志内容
  
第一、二点其实很好做到，但是第三点实施时却并不是那么理想，什么叫不必要的日志，如何优化现有日志内容？优化到什么地步？

毕竟每个系统都有不同的复杂度，工程师的技术能力也不同，优化出来的结果参差不齐，简单说就是没有一个标准，后来也不了了之，因为没有人挨个检查，检查的标准都没有。

虽然之后再没出现上述事故，但是日志的处理还是一个值得思考的问题。

## 更多学习到的

**持续学习**是我从毛大身上学到最重要的一点，即使职位再过，任务再繁重，仍然是有可学习的时间，关键就是能不能利用起来，很多碎片化的时间都悄悄的流逝了，自己还察觉不到。日积月累，自己的技术没有什么几步，导致处理问题、完善业务时明显心有余而力不足，一种深深的无奈感油然而生。

趁着自己年轻，及时止损，让自己主动去学习，去探索，种树最好的时机是十年前，其次是现在！

加油吧，少年！